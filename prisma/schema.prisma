generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ===== ENUMS =====
enum Role {
  CUSTOMER
  ADMIN
  SELLER // ğŸ‘ˆ Ø®ÙŠØ§Ø± Ø¥Ø¶Ø§ÙÙŠ Ù„Ùˆ ØªÙˆØ³Ø¹Øª Ù„Ù…Ø§Ø±ÙƒØª Ø¨Ù„ÙŠØ³
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED // ğŸ‘ˆ Ø§Ù„Ø·Ù„Ø¨ ÙˆØµÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
  COMPLETED // ğŸ‘ˆ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ ÙØªØ±Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø·Ù„Ø¨
  CANCELED
  RETURNED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
  DISPUTED
}

enum PaymentMethod {
  CREDIT_CARD
  PAYPAL
  BANK_TRANSFER
  COD // ğŸ‘ˆ Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
}

enum PaymentProvider {
  STRIPE
  PAYPAL
  BANK
  COD
}

// ===== MODELS =====
// model User {
//   id        Int       @id @default(autoincrement())
//   name      String
//   email     String    @unique
//   password  String
//   role      Role      @default(CUSTOMER)
//   createdAt DateTime  @default(now())
//   addresses Address[]
//   orders    Order[]
//   cart      Cart?
// }

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(CUSTOMER)
  createdAt DateTime @default(now())
  isVerified       Boolean   @default(false)
  verificationToken String? 
  verificationTokenExpires DateTime? 
  resetPasswordToken String?
  resetPasswordExpires DateTime?

  addresses Address[]
  orders    Order[]
  cart      Cart?
  wishlist  Wishlist[] // ğŸ‘ˆ back relation
  reviews   Review[]   // ğŸ‘ˆ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ø¹ÙƒØ³ÙŠØ© Ù…Ø¹ Review
}

model Address {
  id         Int    @id @default(autoincrement())
  user       User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     Int
  street     String
  city       String
  country    String
  postalCode String
}

model Category {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  description String?
  products    Product[]
}

// model Product {
//   id          Int       @id @default(autoincrement())
//   title       String
//   slug        String    @unique
//   description String?
//   price       Decimal   @db.Decimal(10,2)
//   stock       Int       @default(0)
//   createdAt   DateTime  @default(now())
//   category    Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
//   categoryId  Int?
//   orderItems  OrderItem[]
//   cartItems   CartItem[]

//   @@index([categoryId])
//   @@index([slug])
// }

model Review {
  id        Int      @id @default(autoincrement())
  rating    Int      // Ù…Ù† 1 Ø¥Ù„Ù‰ 5
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  product   Product  @relation(fields: [productId], references: [id])
  productId Int

  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  // ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø±Ø§Ø¬Ø¹Ø© Ù„Ù†ÙØ³ Ø§Ù„Ù…Ù†ØªØ¬
  @@unique([productId, userId])
} 


model Product {
  id          Int      @id @default(autoincrement())
  title       String
  slug        String   @unique
  description String?
  price       Decimal  @db.Decimal(10, 2)
  stock       Int      @default(0)
  images      ProductImage[]  // Ø¹Ù„Ø§Ù‚Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØ±
  createdAt   DateTime @default(now())

  category   Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  categoryId Int?

  reviews     Review[]  // ğŸ‘ˆ Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª
  avgRating   Float     @default(0) // Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…

  orderItems OrderItem[]
  cartItems  CartItem[]
  wishlist   Wishlist[] // ğŸ‘ˆ back relation

  @@index([categoryId])
  @@index([slug])
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  url       String  // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Cloudinary
  productId Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Cart {
  id        Int        @id @default(autoincrement())
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int        @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     CartItem[]
}

model CartItem {
  id        Int     @id @default(autoincrement())
  cart      Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  cartId    Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int
  quantity  Int     @default(1)

  @@unique([cartId, productId])
}

model Order {
  id            Int            @id @default(autoincrement())
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        Int
  totalAmount   Decimal        @db.Decimal(10, 2)
  status        OrderStatus    @default(PENDING)
  paymentMethod PaymentMethod?
  createdAt     DateTime       @default(now())
  items         OrderItem[]
  payment       Payment?

  @@index([userId])
  @@index([status])
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId   Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Restrict)
  productId Int
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
}

model Payment {
  id            Int             @id @default(autoincrement())
  order         Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId       Int             @unique
  provider      PaymentProvider
  transactionId String?         @unique
  status        PaymentStatus   @default(PENDING)
  createdAt     DateTime        @default(now())

  @@index([status])
}

// model Wishlist {
//   id        Int      @id @default(autoincrement())
//   user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
//   userId    Int
//   product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
//   productId Int

//   createdAt DateTime @default(now())

//   @@unique([userId, productId]) // Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø§ ÙŠØ¶ÙŠÙ Ù†ÙØ³ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø±ØªÙŠÙ†
// }
model Wishlist {
  id        Int     @id @default(autoincrement())
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int

  createdAt DateTime @default(now())

  @@unique([userId, productId])
}
